<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: main.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * Busybee module loader
 *
 * applies module files/directories in ./busybee to exports. It assumes that
 * everything in ./busybee, whether file or dir, is a module to be applied
 * to exports.
 *
 * @module busybee
 */

var _       = require('lodash'),
    fs      = require('fs'),
    BusyBee;

/**
 * @const {String[]} NO_INIT_MODULES
 *
 * These modules do not require busybee.init to
 * have been called prior to their reference
 */
const NO_INIT_MODULES = ['cluster'];

/**
 * Discovers modules in lib/busybee and applies getters
 * to this object on their behalf
 *
 * For example:
 * busybee/broker.js -> 'busybee.broker'
 *
 * @constructor
 */
function BusyBee() {

  var busybee = this;

  fs.readdirSync(__dirname + '/busybee').forEach(function (filename) {

    var module = filename.replace(/\.js$/, '');
    // A getter is used here because we only want to initialize
    // a module on first inclusion. Thus if a module is never used
    // in an application, it is never intialized
    Object.defineProperty(busybee, module, {
      get: function () {
        if (busybee.ready || _.contains(NO_INIT_MODULES, module)) {
          return require('./busybee/' + module);
        } else {
          throw new Error('BusyBee must be initialized before any modules are run.');
        }
      }
    });

  });

  return _.bindAll(this);

};

/** @property {Boolean} ready Is busybee initialized? */
BusyBee.prototype.ready = false;

/**
 * sets up some application defaults and loads config module straight away
 *
 * @param {Object} options
 * @param {String} options.name The name of the application. This informs config
 *                              loading and logger behavior.
 * @param {String} options.path Options configuration file path.
 *
 * @return this
 * @throws {Error} if options.name is not present
 */
BusyBee.prototype.init = function (options) {

  if (this.ready) return this;

  if (!(options && options.name)) {
    throw new Error('BusyBee module was initialized without an app name specified');
  }

  global.busybee = this; // :(

  this.ready = true;

  this.connection;
  this.conf.init(options);
  this.logger.init(this.conf);
  this.locator.init(this.conf);

  return this;
};

module.exports = new BusyBee();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-busybee.html">busybee</a></li></ul><h3>Classes</h3><ul><li><a href="Broker.html">Broker</a></li><li><a href="Cluster.html">Cluster</a></li><li><a href="Locator.html">Locator</a></li><li><a href="Logger.html">Logger</a></li><li><a href="module-busybee-BusyBee.html">BusyBee</a></li><li><a href="Pull.html">Pull</a></li><li><a href="Push.html">Push</a></li><li><a href="Rep.html">Rep</a></li><li><a href="Req.html">Req</a></li><li><a href="Worker.html">Worker</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_">_</a></li><li><a href="global.html#NO_INIT_MODULES

These modules do not require busybee.init to
have been called prior to their reference">NO_INIT_MODULES

These modules do not require busybee.init to
have been called prior to their reference</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Wed Sep 25 2013 11:49:10 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
